(window.webpackJsonp=window.webpackJsonp||[]).push([[176],{1340:function(e,t,n){"use strict";n.r(t);var o=n(316),r=n(9);var c=function(e,t,n,o){const r="up_g_one_tap_closed",c=new Date((new Date).getTime()+864e5);return!o.get(r)&&(n("impression","show_widget"),window.google.accounts.id.initialize({client_id:e,callback:e=>{t(e.credential)}}),window.google.accounts.id.prompt((e=>{"tap_outside"===e.getSkippedReason()&&o.set(r,!0,{expires:c})})),!0)};let l;var d={methods:{trackEvent(e){const t="page"===e.event?["olog"]:["olog","snowplow"];return this.$tracker.track({...e,trackers:t})},async logEvent(e){const t={...e};var n;n="id",{}.hasOwnProperty.call(e.data||{},n)&&(t.data.id=this.$store.state.context.user.uid),await this.trackEvent(t)},async logImpressionEvent(e,t){!l&&t&&(await this.logEvent(t),l=!0),await this.logEvent(e)},extendLogData:(e,data)=>({...e,data:{...e.data||{},...data}})}},h=n(2),w=Object(h.a)(d,undefined,undefined,!1,null,null,null).exports;const f=e=>'\n    mutation {\n        redirectUrl(input: {\n            credential: "'.concat(e,'"\n        }) {\n        login\n        redirectStatusDetail\n        redirectTo\n        success\n        }\n    }\n');class v{constructor(e,t){this.$httpGql=void 0,this.$logger=void 0,this.$httpGql=e,this.$logger=t}async authorizeWithOneTap(e){if(!e)return{login:!1,redirectTo:null};try{var t;const{data:data,errors:n}=await this.$httpGql({handleApiErrors:!0,useSubordinateOauth:!0}).post({query:f(e)}).json();if(!n)return(null==data?void 0:data.redirectUrl)||{};null===(t=this.$logger)||void 0===t||t.error("[ACQ] onTapRedirectUrl error: ",n)}catch(e){var n;null===(n=this.$logger)||void 0===n||n.error("[ACQ] onTapRedirectUrl error: ",e)}return!1}}var m={name:"GoogleOneTap",mixins:[w],props:{clientId:{type:String,required:!0}},head(){return{script:[{hid:"google-qsi-client",src:"https://accounts.google.com/gsi/client",defer:!0,callback:()=>{c(this.clientId,this.signUpWithOneTap,this.logWidget,this.$cookies)}}]}},methods:{logWidget(e,label){this.logEvent({event:e,sublocation:"one_tap_sign_up",label:label})},async signUpWithOneTap(e){var t;await Object(r.a)(this.$store,{ff:[{name:"MP18843OneTapRedirectURL",fallback:!1}]});const n=null===(t=this.$store.state.flags.ff)||void 0===t?void 0:t.MP18843OneTapRedirectURL,{login:o,redirectTo:c}=await this.authorizeWithOneTap(e,n);if(o)try{if(!await this.logIn(o,e))return;await this.$store.dispatch("context/change"),this.logWidget("click","existing_user_with_one_tap");const t=await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{$httpGql:n,store:o,$logger:r}=e;try{var c,l;const e=t.userId||(null===(c=o.state)||void 0===c||null===(c=c.user)||void 0===c?void 0:c.id),r=t.orgId||(null===(l=o.state)||void 0===l||null===(l=l.orgs)||void 0===l||null===(l=l.current)||void 0===l?void 0:l.id),d=t.redirectType||"",h=!!t.forceDisableCache;return(await n({handleApiErrors:!1}).post({query:"query getFirstRedirect($forceDisableCache: Boolean, $orgId: ID, $userId: ID, $redirectType: String) {\n  firstRedirect(\n    personId: $userId\n    forceDisableCache: $forceDisableCache\n    orgId: $orgId\n    redirectType: $redirectType\n  ) {\n    description\n    redirectId\n    redirectUrl\n  }\n}",variables:{userId:e,orgId:r,forceDisableCache:h,redirectType:d}}).json()).data.firstRedirect}catch(e){r.error("GetHomeRedirect failed",e)}return null}(this.$nuxt.context);window.location.href=this.$localePrefix(t.redirectUrl)}catch(e){"password"===e&&(this.logWidget("click","existing_user_without_one_tap"),window.localStorage.setItem("existingAccountLoginAlert",!0)),window.location.href=this.$localePrefix("/ab/account-security/login")}else c&&(this.logWidget("click","new_user_with_one_tap"),window.location.href=this.$localePrefix(c))},authorizeWithOneTap(e,t){if(t){return new v(this.$httpGql,this.$logger).authorizeWithOneTap(e).then((e=>e.data?e.data:e))}return this.$http({handleApiErrors:!1}).url("/signup/one-tap-redirect-url?credential=".concat(encodeURI(e))).get().json()},logIn(e,t){return o.a.withSso({email:e,clientId:this.clientId,provider:"google",authResponse:{id_token:t}},null,this.$store.state.forter.token)}}},k=m,y=Object(h.a)(k,(function(){return(0,this._self._c)("div")}),[],!1,null,null,null);t.default=y.exports},304:function(e){e.exports=JSON.parse('{"asui_PleaseWait_12":"Please wait..."}')},305:function(e){e.exports=JSON.parse("{}")},316:function(e,t,n){"use strict";var o=n(19),r=n(61),c=n(62),l=n(67),d=n(69),h=n(68),w=n(0),f=n(46),v=n(38),m={en:n(304),is:n(305)};w.default.use(f.a);var k=new f.a({fallbackLocale:"en",silentFallbackWarn:!0,locale:"undefined"==typeof window?"en":Object(v.a)("lang")||"en",messages:m}),y="cloudflare";let _={};var T={externalCaptchaRequested:async e=>!(403!==e.status&&503!==e.status||!(null!=e.headers.get("cf-chl-bypass")||e.headers.get("cf-mitigated")&&"challenge"===e.headers.get("cf-mitigated")||-1!==(await e.clone().text()).indexOf("cloudflare.com")))&&y,async handle(e,t){let n=_[e];return n||($("user_challenged"),await Promise.all(Object.values(_)),n=async function(e){const iframe=await function(e){const iframe=document.createElement("iframe");Object.assign(iframe.style,{width:"100%",height:"100%",position:"fixed","z-index":99999999,backgroundColor:"white",top:0}),iframe.style.setProperty("display","block","important"),iframe.setAttribute("id","externalChallenge"),iframe.innerText=k.t("asui_PleaseWait_12"),document.body.appendChild(iframe);const t=new Promise((e=>{iframe.onload=()=>{iframe.onload=void 0,iframe.prevContentDocument=iframe.contentDocument,e(iframe)}}));return iframe.src="".concat(e+(e.includes("?")?"&":"?"),"cloudflareLoader"),t}(e);do{await I(iframe)}while(!await O(e));iframe.remove()}(t),_[e]=n,n.then((()=>{delete _[e],setTimeout((()=>{$("challenge_passed")}),1e3)})))}};async function O(e){const t=await fetch(e+(e.includes("?")?"&":"?")+"endpointCheck");return 403===t.status&&$("challenge_failed"),403!==t.status}function I(iframe){return new Promise((e=>{const t=setInterval((()=>{iframe.contentDocument!==iframe.prevContentDocument&&(iframe.prevContentDocument=iframe.contentDocument,$("challenge_tried"),clearInterval(t),e())}),300)}))}function $(e){"undefined"!=typeof window&&window.$nuxt&&window.$nuxt.$tracker&&window.$nuxt.$tracker.track({event:"impression",sublocation:"page",label:e,trackers:["snowplow"]})}let x=[(e,t,n)=>401!==e.status||t.tokenRefreshWasPerformed?e:(t.tokenRefreshWasPerformed=!0,S(h.a).middlewares([Object(r.a)(),Object(c.a)([Object(d.a)()])],!0).get().res((()=>n())))],C=[e=>(t,n)=>function o(){return e(t,n).then((async e=>{const n=await T.externalCaptchaRequested(e);return n?(await T.handle(n,t),o()):e}))}()],P={"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"};var j={getInterceptors:()=>x,getMiddlewares:()=>C,getHeaders:()=>Object.assign({},P),addInterceptor(e){x.push(e)},setHeader(header,e){P[header]=e}},S=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return Object(o.a)(e).options({context:n}).headers(j.getHeaders()).middlewares([...j.getMiddlewares(),Object(r.a)(),Object(c.a)([...j.getInterceptors(),...t])]).options({credentials:"same-origin",requestInfo:new l.a})},D=n(39),W=n(28);var A={openWebsocketWithToken(e){e||(e=W.a.getValueFromNameSelector(W.a.getPrefix()+"oauth2_global_js_token"));const t=window.NUXT_APP_CONFIG?NUXT_APP_CONFIG.transportLayerEndpoint:Applet.getVar("transport_layer_url");if(!t)throw new Error("Transport layer endpoint is not defined");return new WebSocket("".concat(t,"?app=AccountSecurity&libVersion=4.8.0&oauth2_token=").concat(e,"&X-Atmosphere-tracking-id=0&X-Atmosphere-Framework=2.3.8-javascript&X-Atmosphere-Transport=websocket&X-Atmosphere-TrackMessageSize=true&X-atmo-protocol=true"))}};var R=e=>async(t,n,o)=>{const data=t.data||{};if(n.locked=1!==n.retryCounter&&!!data.securityCheckCertificate,e&&e(n.locked),!n.locked)return t;await new Promise((async e=>{await function(e,t,n,o){if(e.resolve=o,e.webSocket)return Promise.resolve();return e.webSocket=A.openWebsocketWithToken(t),e.webSocket.onmessage=t=>{var n;let data={};try{data=JSON.parse(t.data)}catch(e){}"LOGIN_DECISION_AVAILABLE"===(null===(n=data)||void 0===n?void 0:n.eventName)&&(e.resolve(),e.webSocket.close()),e.webSocket.onclose=()=>e.webSocket=null},new Promise((t=>{e.webSocket.onopen=t,setTimeout(t,2e3)}))}(n,data.authToken,data.requestId,e),setTimeout((()=>e()),void 0===n.retryCounter?0:6e3)}));const r=JSON.parse(n.body);return Object.assign(r.login,{securityCheckCertificate:data.securityCheckCertificate,authToken:data.authToken}),n.body=JSON.stringify(r),n.retryCounter=void 0===n.retryCounter?30:n.retryCounter-1,o()};const E="password",L="sso",U="challenge";let G=null,N={};function X(e){return 1===e.success?Promise.resolve(!0):Promise.reject(null==e?void 0:e.mode)}async function z(data){return data.iovation||(data.iovation=await new Promise((async e=>{setTimeout((()=>e("")),1e3),e(await((e,t)=>{window.io_global_object_name="IGLOO";const n=new Promise((e=>{const t=setTimeout((()=>e("")),3e3);window.IGLOO=window.IGLOO||{enable_flash:!1,bb_callback:(n,o)=>{t&&clearTimeout(t),o&&e(n)},loader:{uri_hook:"/iojs",version:"general5"}}})),o=()=>{const script=document.createElement("script");script.type="text/javascript",script.src="https://www.upwork.com/static/iovation/5.2.2/loader_only.js",document.body.appendChild(script)};"loading"!==document.readyState?o():document.addEventListener("DOMContentLoaded",o,{once:!0});const r={bbPromise:n,getBlackbox:()=>window.IGLOO.getBlackbox()};return e?t("iovation",r):r})().bbPromise)}))),S(D.a,[R()]).headers(N).post({login:data}).json((e=>{if(0===(null==e?void 0:e.challengeType)&&G){const t={login:{deviceAuthorization:{answer:G,remember:!0},mode:U,iovation:data.iovation,authToken:null==e?void 0:e.authToken,forterToken:data.forterToken,challengeData:null==e?void 0:e.challengeData}};return data.username?t.login.username=data.username:t.login.ssoUserData=data.ssoUserData,function(data){return S(D.a).headers(N).post(data).json((e=>X(e)))}(t)}return X(e)}))}t.a={headers(e){return N=e,this},provideSecurityAnswer(e){return G=e,this},withSso:function(e){return z({mode:L,ssoUserData:e,iovation:arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,forterToken:arguments.length>2&&void 0!==arguments[2]?arguments[2]:null})},withPassword:function(e,t){return z({mode:E,username:e,password:t,iovation:arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,forterToken:arguments.length>3&&void 0!==arguments[3]?arguments[3]:null})}}}}]);
//# sourceMappingURL=https://upwork-usw2-staging-assets-jsmaps.s3.us-west-2.amazonaws.com/Brontes/up-s-google-one-tap.e9c22f9e.js.map